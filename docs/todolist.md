Todolist
========

Legend: Pending | In Progress | Blocked | Done

| Task | Status | Test Approach | Notes/Dependencies |
| --- | --- | --- | --- |
| Draft/Review docs (spec.md with Mermaid diagrams, api.md, decisions) | Done | Manual review; optional `Select-String` check for Mermaid blocks | Required before any code moves |
| Document global LaTeX persistence (spec/api/decisions updates) | Done | Manual doc review; confirm Mermaid blocks intact | Prereq for fixing global_latex_template.html storage |
| Document series LaTeX context/API (placeholders, outputs) | Done | Manual doc review for spec/api/decisions; ensure Mermaid blocks still present | Context window reset 2025-12-01; prerequisite for backend/frontend work |
| Implement series LaTeX backend (context, template CRUD, outputs/PDF) | Pending | Unit: LatexService series methods + substitution map; Integration: `/api/latex/series/context|templates|outputs` returning correlation IDs and writing latex_outputs/last_pdf_path; manual PDF build for sample series | Depends on series LaTeX docs; requires pdflatex path in config/app.php |
| Wire series_latex_template.html to APIs (context load, preview, save compile/PDF/download) | Pending | Browser manual for `series_id=9`: metadata/custom fields match DB, template list populated, compile preview substitutes `{{field_key}}`, Save Compile persists latex_outputs, Save PDF writes file + download link, errors show correlation ID | Blocks on backend endpoints and context API |
| Validate series LaTeX flow + refresh todolist statuses | Pending | `php -l` for changed PHP; manual API smoke; optional extend `tests/verify_latex.php` for series; browser regression on series page | After backend/frontend complete |
| Global LaTeX API persistence (templates + variables to DB) | Done | API manual: create/update/delete templates + variables, verify MySQL rows and correlation IDs; `php tests/verify_latex.php` | Use `latex_templates`/`latex_variables` with `is_global=1`; depends on docs |
| Wire global_latex_template.html to persisted API data (no hardcoded values) | Done | Manual UI: add/edit/delete template + variable, reload page to confirm persistence and preview renders | Depends on global LaTeX API persistence; backend verified, browser smoke recommended |
| Remove LaTeX empty-content front-end blocker text | Done | Manual UI: click Save without LaTeX; confirm no front-end warning; backend response still handled | Small UX tweak; reflected in decisions |
| Normalize global LaTeX API payloads (accept JSON/form + legacy field names) | Done | Manual API/UI: submit with title/latex and with legacy `latex_content`/form-encoded payload; confirm save succeeds and data persists | Prevents false "Title and LaTeX content are required" errors |
| Allow blank LaTeX content in API | Done | Manual UI/API: submit template with title but empty LaTeX; expect success and persisted empty latex_code | Keeps UI aligned; backend no longer rejects blank content |
| Backend OO refactor (controllers in public/, services/repositories in app/, config centralization) | In Progress | Unit tests for services/validation; integration tests hitting DB and endpoints | Depends on docs finalization |
| Frontend update to Bootstrap 5 + DataTables; jQuery via ES6 classes; wire assets to public/assets | In Progress | Browser smoke/E2E for DataTables init and interactions | Depends on backend endpoints stability |
| Series field types (text/number/file) + media storage backend | In Progress | Unit: field type validation, file type/size enforcement, media path builder; Integration: save product + series metadata via JSON and multipart, media download preserves filename | Depends on docs updates (spec/api/decisions); storage/media layout agreed |
| Portal visibility flags on series field definitions (Public Portal Hidden, Backend Portal Hidden) | Done | Manual: create/edit product attribute + metadata fields toggling both flags; reload to confirm persistence; `php -l catalog.php` smoke | Implemented + `php -l catalog.php`; manual UI check recommended |
| Frontend field-type UI + file upload handling | Pending | Browser/E2E: create fields of each type, upload/replace/clear files, verify download link works; Contract: correlation ID surfaced on errors | Depends on backend media endpoints |
| Localize Catalog UI status banners per section (Product Catalog Manager, Series Custom Fields, Series Metadata, Products) | Done | Manual: trigger save/update/delete in each section and confirm only that section's status banner updates; no cross-section leakage | UI-only; no API change expected; browser verification recommended |
| Global loading overlay + top progress bar + interaction lock | Done | Browser manual: simulate API load/save; confirm overlay covers UI, disables scroll and inputs, progress bar visible then hides when idle | Implemented via shared LoadingOverlay across catalog UI/spec search/CSV/LaTeX pages |
| Remove loading overlay/progress bar on Spec Search page (keep interactions) | Done | Manual: spec-search requests show no overlay/progress bar and UI remains scrollable/clickable while inline spinner covers only local controls; quick smoke to confirm overlay still active on Catalog/CSV/LaTeX pages | Depends on updated spec/decisions; UI-only change |
| Add Bootstrap 5 sidebar navigation (catalog_ui.html, spec-search.html, latex-templating.html) | Done | Manual browser check: sidebar renders desktop/mobile, links route correctly | AdminLTE-style left rail implemented (sticky desktop, slide-over mobile) |
| Fix sidebar collapse spacing/gap (AdminLTE behavior) | Done | Manual browser check: desktop collapse shrinks to ~80px icon rail, main content expands; mobile slide-over/backdrop unaffected | Uses shared sidebar CSS/JS |
| Remove sidebar brand icon and collapse text; apply global Meyer reset | Done | Browser smoke across catalog/spec/latex pages to confirm layout unaffected; ensure reset loads before Bootstrap | Requires shared CSS + HTML updates |
| Remove sidebar white margin/gutters | Done | Visual check on catalog/spec/latex pages: sidebar flush to viewport, content retains intended padding | Update layout gutters + body padding |
| Remove sidebar top offset and forced min-height | Done | Visual check: sidebar aligns naturally without forced 100vh; sticky + mobile slide-over unchanged | Update shared sidebar CSS |
| CSV/LaTeX service wrap (no behavior change) with logging and correlation IDs | Pending | Unit tests for import validation; integration test for PDF URL generation | Depends on backend refactor |
| Backend structured logging + global error handler (correlation ID propagation) | In Progress | Unit tests for logger/envelope; integration tests hitting representative endpoints to assert logs + correlation IDs | Requires docs/spec/api/decisions updates (ready) |
| Frontend error handling utility (shared toast/banner, dev console structured log) | In Progress | Browser/dev-mode tests; verify DataTables AJAX and custom calls surface correlation IDs and friendly messages | Depends on backend error envelope |
| Logging enable/disable flag wiring (backend config + frontend awareness) | In Progress | Unit test logger no-op when disabled; integration test still returns correlation IDs; dev browser check that console logging is suppressed when off | Depends on logging tasks above |
| Build/test scripts (PowerShell) and test consolidation (unit/integration/contract) | Pending | Run `scripts/run-tests.ps1` (to be updated) | Depends on refactor tasks |
| Clean-up and verify paths (public/, storage/, assets/) and update docs/todolist statuses | Pending | Regression smoke + contract tests | Final step |
| Document spec-search → catalog edit deep link (query params + prefill behaviors) | Done | Manual review; ensure spec/decisions capture assumptions | Pre-req for implementation |
| Implement spec-search Edit button deep link to catalog UI (prefill hierarchy search + auto-select series + product table filter) | Done | Manual browser test: click Edit redirects with query string, catalog UI selects series, fills search box, and DataTables product filter reflects product param | Depends on document updates |
| Document CSV tools page split (spec/api/decisions updates, nav order) | Done | Manual doc review; ensure Mermaid blocks intact and nav ordering captured | Adds dedicated CSV Import/Export page description before coding |
| Implement CSV Import/Export dedicated page + nav updates | In Progress | Browser manual test: CSV history table, export/import/restore/delete flows, truncate modal; confirm correlation IDs surfaced | New catalog-csv.html + navigation updates; tests pending |
| Document hierarchy node parentId requirement (series updates) | Done | Manual doc review ensuring spec/api/decisions capture parent validation | Added note about resubmitting parent for series updates |
| Fix hierarchy node update payload to include parentId on edit | Done | Manual: update a series node and confirm the save succeeds (no validation_error); check log for correlation ID without error entry | Frontend now resubmits stored parentId to satisfy backend validation |
| Fix display order updates for selected node (preserve value when blank) | Done | Manual: change display order, save, reload hierarchy, confirm value persists | Prevents order reset to zero when field left empty |
| Remove custom spacing/borders on DataTables pagination buttons | In Progress | Manual UI: DataTables pagination shows native sizing (no custom padding/margin/radius/border) and retains hover/current/disabled colors | Update source + public CSS once docs/decisions finalized |
| Remove DataTables pagination focus ring (no blink/double-click) | In Progress | Manual UI: single click paginates; no blue focus halo or scroll jump; hover/current colors still visible | Apply to source + public CSS after docs/decisions update |
| Fix product list DataTable column mismatch after series custom-field deletion | In Progress | Browser manual: delete a product-attribute field on a series with products, reload context, confirm no “incorrect column count” warning and product list renders; console free of errors | Depends on product field CRUD + DataTables setup; update source + public assets |
