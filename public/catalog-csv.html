<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Catalog CSV Import / Export</title>
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="assets/css/sidebar-nav.css">
    <link rel="stylesheet" href="assets/css/catalog_ui.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body data-logging-enabled="true">
    <div class="container-fluid catalog-shell px-0 app-shell">
        <div class="row flex-lg-nowrap g-0">
            <aside class="col-12 col-lg-3 col-xl-2 sidebar-column">
                <div class="sidebar-panel" id="pageSidebar" aria-label="Sidebar Navigation">
                    <div class="sidebar-brand">
                        <div class="brand-text">
                            <div class="title">Catalog Suite</div>
                            <div class="subtitle">AdminLTE-inspired</div>
                        </div>
                        <button class="btn btn-sm sidebar-collapse-btn" type="button" data-sidebar-collapse="true" aria-label="Collapse sidebar">
                            <span class="btn-icon">&#9776;</span>
                        </button>
                    </div>
                    <div class="sidebar-heading">Navigation</div>
                    <nav class="sidebar-nav nav flex-column">
                        <a class="nav-link" href="spec-search.html">
                            <span class="sidebar-indicator"></span>
                            <span class="nav-label">Spec Search</span>
                        </a>
                        <a class="nav-link" href="catalog_ui.html">
                            <span class="sidebar-indicator"></span>
                            <span class="nav-label">Catalog UI</span>
                        </a>
                        <a class="nav-link active" aria-current="page" href="catalog-csv.html">
                            <span class="sidebar-indicator"></span>
                            <span class="nav-label">CSV Import/Export</span>
                        </a>
                        <a class="nav-link" href="latex-templating.html">
                            <span class="sidebar-indicator"></span>
                            <span class="nav-label">LaTeX Templating</span>
                        </a>
                    </nav>
                </div>
            </aside>
            <main class="col-12 col-lg-9 col-xl-10 content-column">
                <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-3">
                    <div>
                        <h1 class="mb-1">Catalog CSV Tools</h1>
                        <p class="text-muted mb-0">Export, import, restore, and audit CSV catalog snapshots.</p>
                    </div>
                    <button class="btn btn-outline-primary d-lg-none app-nav-toggle" type="button" data-sidebar-toggle="true">
                        Open Navigation
                    </button>
                </div>

                <div id="status-message"></div>

                <div class="section row g-0 no-bootstrap-gap">
                    <div class="panel panel-csv csv-section">
                        <h2>CSV Import / Export</h2>
                        <div class="csv-actions">
                            <button type="button" id="csv-export-button">Export Catalog CSV</button>
                            <form id="csv-import-form" enctype="multipart/form-data">
                                <label for="csv-import-file">Import CSV:</label>
                                <input type="file" id="csv-import-file" accept=".csv">
                                <button type="submit" id="csv-import-submit">Import</button>
                            </form>
                            <button type="button" id="truncate-button" class="danger-button">Truncate Catalog</button>
                        </div>
                        <div class="truncate-warning">
                            Truncate wipes every category, series, product, and custom field definition/value before reseeding
                            the baseline tree. Use only when you are ready to import a fresh CSV snapshot.
                        </div>
                        <div class="csv-history">
                            <h3>CSV History</h3>
                            <table id="csv-history-table" class="table table-striped table-hover align-middle datatable w-100">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Name</th>
                                        <th>Timestamp</th>
                                        <th>Size (bytes)</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="5">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="truncate-history">
                            <h3>Truncate Audit History</h3>
                            <p class="truncate-history-note">Latest destructive actions with operator reason and audit identifiers.</p>
                            <table id="truncate-audit-table"
                                class="table table-striped table-hover align-middle datatable w-100">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Reason</th>
                                        <th>Deleted</th>
                                        <th>Audit ID</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4">No truncate actions logged.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <div class="sidebar-backdrop" aria-hidden="true"></div>

        <div id="truncate-modal-backdrop" class="modal-backdrop" hidden></div>
        <div id="truncate-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="truncate-modal-title"
            hidden>
            <div class="modal-content">
                <h3 id="truncate-modal-title">Confirm Catalog Truncate</h3>
                <p>Type <strong>TRUNCATE</strong> and provide a short reason before continuing. This will delete every
                    record.</p>
                <form id="truncate-form">
                    <label for="truncate-confirm-input">Confirmation Text</label>
                    <input type="text" id="truncate-confirm-input" autocomplete="off" placeholder="TRUNCATE" required>
                    <label for="truncate-reason-input">Reason</label>
                    <textarea id="truncate-reason-input" rows="3" maxlength="256"
                        placeholder="Describe why you are truncating." required></textarea>
                    <div id="truncate-modal-error" class="modal-error" aria-live="polite"></div>
                    <div class="modal-actions">
                        <button type="button" id="truncate-cancel-button">Cancel</button>
                        <button type="submit" id="truncate-confirm-button" class="danger-button" disabled>Confirm
                            Truncate</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
    <script src="assets/js/sidebar-nav.js"></script>
    <script src="assets/js/app_loading.js"></script>
    <script src="assets/js/app_error.js"></script>
    <script src="assets/js/catalog_csv.js"></script>
</body>

</html>
